<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Particles</title>
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }
      #tsparticles {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div id="tsparticles"></div>

    <script src="tsparticles.bundle.js"></script>
    <script>
      const stalemateOptions = {
        fpsLimit: 30,
        particles: {
          number: {
            value: 100,
            density: { enable: true },
          },
          color: { value: "#87ceeb" },
          shape: { type: "circle" },
          opacity: { value: 0.5 },
          size: { value: { min: 1, max: 3 } },
          move: {
            enable: true,
            speed: 0.5,
            direction: "none",
            random: true,
            straight: false,
            out_mode: "bounce",
          },
        },
      };

      const attackingOptions = {
        fpsLimit: 60,
        particles: {
          number: { value: 0 },
          color: { value: "#ff4444" },
          shape: { type: "circle" },
          opacity: { value: 1 },
          size: { value: 3 },
          move: {
            enable: true,
            speed: 15,
            direction: "right",
            random: false,
            straight: true,
            out_mode: "destroy",
            trail: {
              enable: true,
              fillColor: "#111111",
              length: 5,
            },
          },
        },
        background: { color: "#111111" },
        emitters: {
          direction: "right",
          position: { x: 0, y: 50 },
          size: { width: 0, height: 100 },
          rate: { delay: 0.01, quantity: 5 },
        },
      };

      const defendingOptions = {
        fpsLimit: 30,
        particles: {
          number: {
            value: 80,
            density: { enable: true },
          },
          color: { value: "#4dff88" },
          shape: { type: "triangle" },
          opacity: { value: 0.6 },
          size: { value: { min: 5, max: 10 } },
          links: {
            enable: true,
            distance: 150,
            color: "#ffffff",
            opacity: 0.4,
            width: 1,
          },
          move: {
            enable: true,
            speed: 1,
            direction: "none",
            random: true,
            straight: false,
            out_mode: "bounce",
          },
        },
        background: { color: "#001a09" },
      };

      (async () => {
        await loadFull(tsParticles);

        await tsParticles.load({
          id: "tsparticles",
          options: initialOptions,
        });

        let previousMsg;

        const so = new WebSocket("ws://localhost:54834/context");
        so.onmessage = (msg) => {
          if (prevousMsg !== msg) {
            previousMsg = msg;
            if (msg === "ScoringAttempt") {
              tsParticles.load({
                id: "tsparticles",
                options: attackingOptions,
              });
            } else if (msg === "GoalDefense") {
              tsParticles.load({
                id: "tsparticles",
                options: defendingOptions,
              });
            } else {
              tsParticles.load({
                id: "tsparticles",
                options: stalemateOptions,
              });
            }
          }
        };
      })();
    </script>
  </body>
</html>
